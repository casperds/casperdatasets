<?xml version="1.0" ?>
<project default="publish" xmlns:ivy="antlib:org.apache.ivy.ant">
	<!-- load properties from build.properties file -->
	<property file="build.properties" />

	<!-- locations -->
	<property name="dist.dir" location="dist" />
	
	<!-- artifact names -->
	<property name="binary.jar" value="${name}-${version}.jar" />
	<property name="javadoc.jar" value="${name}-javadoc-${version}.jar" />
	<property name="sources.jar" value="${name}-sources-${version}.jar" />
	<property name="binary.plus.deps.zip" value="${name}-plus-deps-${version}.zip" />
	<property name="pom-file" value="${name}-${version}.pom" />

	<target name="make-pom" description="Create Maven POM file based on ivy.xml">
		<ivy:makepom ivyfile="ivy.xml" pomfile="${dist.dir}/${pom-file}" conf="*">
		    <!--
		      Mapping confs to scopes is important, otherwise
		      unmapped confs are included as optional. This makes
		      the confs specified below non-optional.
		    -->
		    <mapping conf="compile" scope="compile"/>
			<mapping conf="provided" scope="provided"/>
			<mapping conf="runtime" scope="runtime"/>
			<mapping conf="test" scope="test"/>
			<mapping conf="system" scope="system"/>
		</ivy:makepom>
	</target>
	
	<target name="publish" depends="make-pom" description="Publish JARs to local ivy repository">
		<!-- do a resolve first. this places our ivy.xml in the cache -->
		<ivy:resolve />
		<!-- delete the resolved/delivered ivy.xml file from previous publications
			 in case we have made new changes to ivy.xml since then  
        	 this will be regenerated in the deliver performed by the publish -->
		<delete file="${dist.dir}/ivy-${version}.xml" />
		<ivy:publish artifactspattern="${dist.dir}/[artifact](-[classifier])-${version}.[ext]" status="release" overwrite="true" resolver="local" />
	</target>

	<target name="publish-local-maven-repo" depends="make-pom" description="Publish artifacts to the local maven repo directory">
		<!-- do a resolve first to get organisation property and other details from ivy.xml -->
		<ivy:resolve />
		<ivy:publish resolver="local-maven-repo" forcedeliver="true" overwrite="true" publishivy="false">
			<artifacts pattern="${dist.dir}/[artifact](-[classifier])-${version}.[ext]"/>
		</ivy:publish>
	</target>	
	
</project>
